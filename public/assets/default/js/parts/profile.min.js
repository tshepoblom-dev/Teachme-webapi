(()=>{function e(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var a,i,r,o,s=[],l=!0,d=!1;try{if(r=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;l=!1}else for(;!(l=(a=r.call(t)).done)&&(s.push(a.value),s.length!==n);l=!0);}catch(e){d=!0,i=e}finally{try{if(!l&&null!=t.return&&(o=t.return(),Object(o)!==o))return}finally{if(d)throw i}}return s}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return n(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return n(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,a=new Array(n);t<n;t++)a[t]=e[t];return a}$((function(n){"use strict";n(".inline-reservation-calender").length&&n(".inline-reservation-calender").pDatepicker({inline:!0,altField:"#inlineCalender",initialValue:!0,calendarType:"gregorian",initialValueType:!0,autoClose:!0,altFormat:"DD MMMM YY",calendar:{gregorian:{locale:"en"}},toolbox:{calendarSwitch:{enabled:!1}},navigator:{scroll:{enabled:!1},text:{btnNextText:"<",btnPrevText:">"}},minDate:(new persianDate).subtract("day",0).valueOf(),checkDate:function(e){return function(e){var n=new persianDate(e).day(),t=(new persianDate(e).startOf("day").unix(),new persianDate(e).endOf("day").unix(),!1);for(var a in availableDays)Number(availableDays[a])===n&&(t=!0);return t}(e)},timePicker:{enabled:!1},onSelect:function(e){var t=new persianDate(e),a=t.startOf("day").unix(),i=t.format("dddd"),r=t.format("YYYY-MM-DD");n("#selectedDay").val(r),function(e,t,a){var i=n("#PickTimeContainer"),r=n("#PickTimeBody"),o=n("#availableTimes"),s=i.find(".loading-img"),l=i.attr("data-user-id");i.removeClass("d-none"),n("html, body").animate({scrollTop:i.offset().top-window.innerHeight/2},600),r.addClass("d-none"),s.removeClass("d-none"),r.find(".selected_date span").text(n("#inlineCalender").val());var d={timestamp:e,day_label:t,date:a};n.post("/users/"+l+"/availableTimes",d,(function(e){var n="";e&&void 0!==e.times&&(Object.keys(e.times).forEach((function(t){var a=e.times[t];n+='<div class="position-relative available-times '+(a.can_reserve?"":"disabled")+'">\n<input type="radio" name="time" id="availableTime'+a.id+'" value="'+a.id+'" '+(a.can_reserve?"":"disabled")+' data-type="'+a.meeting_type+'">\n<label for="availableTime'+a.id+'">'+a.time+"</label>\n",a.can_reserve||(n+='<span class="font-12 badge badge-danger text-white reserved-item">'+reservedLang+"</span>"),n+='<input type="hidden" class="js-time-description" value="'+a.description+'"/>',n+="</div>"})),o.html(n))})).always((function(){r.removeClass("d-none"),s.addClass("d-none")}))}(a,i,r)}}),n("body").on("change",'input[name="time"]',(function(t){if(this.checked){var a=function(e,n){var t=new Date(n),a=e.match(/(\d+):(\d+)(AM|PM)/);if(a){var i=parseInt(a[1],10),r=parseInt(a[2],10),o=a[3];"PM"===o&&12!==i&&(i+=12),"AM"===o&&12===i&&(i=0),t.setHours(i,r,0,0)}return t},i=function(e){var t=new Date(v);t.setMinutes(t.getMinutes()+e);var a=f.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0}),i=t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0});o.find(".selected-date-time span").text("".concat(c," | ").concat(a,"-").concat(i)),n("#timefull").val("".concat(a,"-").concat(i))},r=function(){n(".js-extra-time-display").text("".concat(b," min")),i(b)},o=n("#PickTimeBody"),s=n(this),l=s.attr("data-type"),d=s.parent().find("label").text(),c=o.find(".selected_date span").text();o.find(".selected-date-time span").text(c+" | "+d);var u=e(d.split("-").map((function(e){return e.trim()})),2),p=u[0],m=u[1],f=a(p,c),v=a(m,c),b=0;n(".js-time-increase").off("click").on("click",(function(e){e.preventDefault(),e.stopPropagation(),b+30<=240&&(b+=30,r())})),n(".js-time-decrease").off("click").on("click",(function(e){e.preventDefault(),e.stopPropagation(),b-30>=0&&(b-=30,r())})),n(".js-finalize-reserve").removeClass("d-none");var g=n('input[value="online"]').closest(".meeting-type-reserve"),h=n('input[value="in_person"]').closest(".meeting-type-reserve");g.removeClass("disabled"),g.find("input").prop("disabled",!1),h.removeClass("disabled"),h.find("input").prop("disabled",!1),g.find("input").prop("checked",!0),"in_person"===l&&(g.addClass("disabled"),g.find("input").prop("disabled",!0)),"online"===l&&(h.addClass("disabled"),h.find("input").prop("disabled",!0));var y=s.parent().find(".js-time-description"),C=n(".js-time-description-card");y&&y.val()&&"null"!==y.val()&&"undefined"!==y.val()?(C.removeClass("d-none"),C.text(y.val())):C.addClass("d-none"),n(".js-add-time-options").removeClass("d-none"),i(0),n(".js-add-time-btn").off("click").on("click",(function(e){e.preventDefault(),e.stopPropagation();var t=parseInt(n(this).data("extra-time"),10);return i(t),!1})),n(".js-reserve-btn").removeClass("d-none").addClass("d-flex"),n(".js-reserve-description").removeClass("d-none")}})),n("body").on("change",'input[name="meeting_type"]',(function(e){if(n("#withGroupMeetingSwitch").prop("checked",!1),n(".js-group-meeting-options").addClass("d-none"),n('input[name="student_count"]').val(1),n(".wrunner").remove(),this.checked){var t=n(this).val(),a=n(".js-group-meeting-switch"),i=n(".js-online-group-amount"),r=n(".js-in-person-group-amount");a.removeClass("d-none").addClass("d-flex"),"in_person"===t&&(i.addClass("d-none"),r.removeClass("d-none")),"online"===t&&(i.removeClass("d-none"),r.addClass("d-none")),n(".js-reserve-btn").removeClass("d-none").addClass("d-flex"),n(".js-reserve-description").removeClass("d-none")}})),n("body").on("change","#withGroupMeetingSwitch",(function(e){var t=n(".js-group-meeting-options");n('input[name="student_count"]').val(1),n(".wrunner").remove(),this.checked?(t.removeClass("d-none"),function(){var e=n("#studentCountRange");if(e&&jQuery().wRunner){var t=n('input[name="meeting_type"]:checked').val();if(t){var a=e.attr("data-minLimit"),i="in_person"===t?n("#in_person_group_max_student").val():n("#online_group_max_student").val(),r=e.find('input[name="student_count"]');e.wRunner({type:"single",limits:{minLimit:a,maxLimit:i},singleValue:a,step:1}).onValueUpdate((function(e){r.val(e.value)}))}}}()):t.addClass("d-none")})),n("body").on("click",".js-submit-form",(function(e){e.preventDefault();var t=n(this);t.addClass("loadingbar primary").prop("disabled",!0);var a=t.closest("form"),i=(a.attr("action"),a.serializeObject());n.post("/meetings/reserve",i,(function(e){n.toast({heading:e.title,text:e.msg,bgColor:"success"===e.status?"#43d477":"#f63c3c",textColor:"white",hideAfter:1e4,position:"bottom-right",icon:e.status}),"success"===e.status&&void 0!==e.redirect?window.location.href=e.redirect:t.removeClass("loadingbar gray").prop("disabled",!1)})).fail((function(e){t.removeClass("loadingbar gray").prop("disabled",!1)}))})),n("body").on("click","#followToggle",(function(e){e.preventDefault();var t=n(this);t.addClass("loadingbar primary").prop("disabled",!0);var a="/users/"+t.attr("data-user-id")+"/follow";n.get(a,(function(e){t.removeClass("loadingbar primary").prop("disabled",!1),e&&200===e.code&&(e.follow?(t.removeClass("btn-primary").addClass("btn-danger"),t.text(unFollowLang)):(t.removeClass("btn-danger").addClass("btn-primary"),t.text(followLang)))}))})),n("body").on("click",".js-refresh-captcha",(function(e){e.preventDefault(),refreshCaptcha()})),n("body").on("click",".js-send-message",(function(e){e.preventDefault(),Swal.fire({html:n("#sendMessageModal").html(),showCancelButton:!1,showConfirmButton:!1,customClass:{content:"p-0 text-left"},onOpen:function(){refreshCaptcha()},width:"42rem"})})),n("body").on("click",".js-send-message-submit",(function(e){e.preventDefault();var t=n(this);t.addClass("loadingbar primary").prop("disabled",!0);var a=t.closest("form"),i=a.attr("action"),r=a.serializeObject();n.post(i,r,(function(e){e&&200===e.code?(Swal.fire({icon:"success",html:'<h3 class="font-20 text-center text-dark-blue">'+messageSuccessSentLang+"</h3>",showConfirmButton:!1}),setTimeout((function(){window.location.reload()}),2e3)):Swal.fire({icon:"error",html:'<h3 class="font-20 text-center text-dark-blue">'+e.message+"</h3>",showConfirmButton:!1})})).fail((function(e){t.removeClass("loadingbar primary").prop("disabled",!1);var n=e.responseJSON;refreshCaptcha(),n&&n.errors&&Object.keys(n.errors).forEach((function(e){var t=n.errors[e],i=a.find('[name="'+e+'"]');i.addClass("is-invalid"),i.parent().find(".invalid-feedback").text(t[0])}))}))}))}))})();